

# ç¥ç»ç½‘ç»œ

[TOC]

## æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰

### æ¨¡å‹
#### æ¦‚è¿°
* åœ¨æ„ŸçŸ¥æœºæ¨¡å‹æ‰©å±•è€Œæ¥
* å°†å¾ˆå¤šäº†ç¥ç»å•å…ƒè¿æ¥ä¸ºç½‘ç»œçŠ¶

#### ç¥ç»å…ƒ
##### å®šä¹‰
* å¤šä¸ªè¾“å…¥è¿›è¿‡ä¸€ä¸ªçº¿æ€§å…³ç³»ï¼Œå¾—åˆ°ä¸€ä¸ªåŠ æƒå€¼
    * $ z = w_1 x_1 + w_2 x_2 + ... + w_n x_n + b $
* åŠ æƒå€¼ç»è¿‡ä¸€ä¸ªæ¿€æ´»å‡½æ•°å¤„ç†ï¼Œå¾—åˆ°è¾“å‡º

##### å›¾ç¤º
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201225192424.png)

#### åŸºæœ¬ç»“æ„
##### å®šä¹‰
* åˆ†æˆä¸‰ç±»ä¸åŒçš„å±‚ï¼šè¾“å…¥å±‚(ä¸€ä¸ª)ã€éšè—å±‚(å¤šä¸ª)ï¼Œè¾“å‡ºå±‚(ä¸€ä¸ª)
* å±‚ä¸å±‚ä¹‹é—´æ˜¯å…¨è¿æ¥çš„ï¼šå‰ä¸€å±‚çš„ç¥ç»å•å…ƒä¸ä¸‹ä¸€å±‚çš„æ‰€æœ‰ç¥ç»å•å…ƒéƒ½æœ‰è¿æ¥

##### å›¾ç¤º
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201225194007.png)


### æ•°å­¦æ¨¡å‹
#### ç¬¦å·å®šä¹‰
| ç¬¦å· | å«ä¹‰ | 
| -- | -- | 
| $x_i$ | è¾“å…¥å±‚çš„ç¬¬iä¸ªç¥ç»å…ƒçš„è¾“å…¥ |
| $a_j^l$ | ç¬¬lå±‚çš„ç¬¬jä¸ªç¥ç»å…ƒçš„è¾“å‡º |
| $z_j^l$ | ç¬¬lå±‚çš„ç¬¬jä¸ªç¥ç»å…ƒçš„åŠ æƒå€¼ |
| $b_j^l$ | ç¬¬lå±‚çš„ç¬¬jä¸ªç¥ç»å…ƒçš„åç½® |
| $w_{ji}^l$ | ç¬¬l-1å±‚çš„ç¬¬iä¸ªç¥ç»å…ƒåˆ°ç¬¬lå±‚çš„ç¬¬jä¸ªç¥ç»å…ƒçš„è¾“å…¥æƒé‡ |

#### å›¾ç¤º
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201225201751.png)


### å‰å‘ä¼ æ’­ç®—æ³•
* åˆ©ç”¨ä¸Šä¸€å±‚è¾“å‡ºè®¡ç®—ä¸‹ä¸€å±‚çš„è¾“å‡º

#### å…¬å¼
$$
a^l = \sigma(W^l a^{l-1} + b^l)
$$
è¯´æ˜
* $W$ä¸ºçŸ©é˜µ
* $b$, $a$ä¸ºå‘é‡
* $\sigma$ä¸ºæ¿€æ´»å‡½æ•°

#### æµç¨‹
* è¾“å…¥ï¼šæ€»å±‚æ•°Lï¼Œæƒé‡çŸ©é˜µWï¼Œåç½®å‘é‡bï¼Œè¾“å…¥å‘é‡x
* è¾“å‡ºï¼šè¾“å‡ºå±‚çš„è¾“å‡º $a^L$
* æ­¥éª¤
    1. åˆå§‹åŒ– $a^1 = x$
    2. for l=2 to Lï¼Œè®¡ç®—$a^l$


### åå‘ä¼ æ’­ç®—æ³•
* ç”¨äºæ¢¯åº¦ä¸‹é™æ³•å¯¹æŸå¤±å‡½æ•°æ±‚æå°å€¼
* åˆ©ç”¨ä¸‹ä¸€å±‚çš„ç¥ç»å•å…ƒè¯¯å·®ï¼Œæ¥è®¡ç®—ä¸Šä¸€å±‚çš„ç¥ç»å•å…ƒè¯¯å·®

#### ç¥ç»å•å…ƒè¯¯å·®
$$
\delta_j^l = \frac{\partial C}{\partial z_j^l}
$$

#### å…¬å¼
$$
\delta^l = (W^{l+1})^T \delta^{l+1} \odot \sigma'(z^l)
$$

#### æ¢¯åº¦å…¬å¼
$$
\frac{\partial C}{\partial w_{ji}^l} = \delta_j^l a_i^{l-1}
$$
$$
\frac{\partial C}{\partial b_j^l} = \delta_j^l
$$

#### æµç¨‹
* è¾“å…¥ï¼š
    * æ€»å±‚æ•°Lï¼Œæ€»ç¥ç»å…ƒä¸ªæ•°ï¼Œæ¿€æ´»å‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ï¼Œè¾“å…¥çš„mä¸ªæ ·æœ¬
    * è¿­ä»£æ­¥é•¿$\alpha$ï¼Œæœ€å¤§è¿­ä»£æ¬¡æ•°MAXï¼Œåœæ­¢è¿­ä»£é˜ˆå€¼$\epsilon$
* è¾“å‡ºï¼š
    * æƒé‡çŸ©é˜µ$W$ï¼Œåç½®å‘é‡$b$
* æ­¥éª¤
    1. åˆå§‹åŒ–$W$,$b$ä¸ºéšæœºå€¼
    1. for iter to 1 to MAX
        1. è®¡ç®—å‡ºå„å±‚çš„ç¥ç»å•å…ƒè¯¯å·®
            1. for i = 1 to m
            1. è®¾ç½® $a^1 = x$
            1. for l = 2 to L : è®¡ç®— $a_i^l$ çš„å€¼
            1. é€šè¿‡æŸå¤±å‡½æ•°ï¼Œè®¡ç®—å‡ºè¾“å‡ºå±‚çš„ $\delta^L$
            1. for l = L-1 to 2 : è®¡ç®—å„å±‚çš„ $\delta^l$å€¼
        1. æ›´æ–°æƒé‡ã€åç½®
            1. for ğ‘™ = 2 to L
            1. $ W^l = W^l - \alpha \delta^l (a^{l-1})^T $
            1. $ b^l = b^l -  \alpha \delta^l $
    1. å¦‚æœæ‰€æœ‰çš„$W$,$b$å˜åŒ–å€¼éƒ½å°äº$\epsilon$ï¼Œåˆ™è·³å‡ºå¾ªç¯



### å‡½æ•°é€‰æ‹©
* æŸå¤±å‡½æ•° + æ¿€æ´»å‡½æ•°

#### ç»„åˆ1
* å‡æ–¹å·® + Sigmoid
* Sigmoidå‡½æ•°ä¼šå¯¼è‡´ç®—æ³•æ”¶æ•›é€Ÿåº¦æ…¢

#### ç»„åˆ2
* äº¤å‰ç†µ + Sigmoid
* åŠ å¿«ç®—æ³•æ”¶æ•›é€Ÿåº¦

#### ç»„åˆ3
* å¯¹æ•°ä¼¼ç„¶ + softmax
* å¤„ç†å¤šåˆ†ç±»é—®é¢˜


## å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰

### åŸºæœ¬ç»“æ„
* éšè—å±‚ç”±å¤šä¸ªå…·æœ‰ç»“æ„çš„å±‚ç»„æˆ
* ç»“æ„ï¼šå·ç§¯å±‚ å’Œ æ± åŒ–å±‚

#### å·ç§¯å±‚
* ä½¿ç”¨è¿‡æ»¤å™¨æ‰«æåŸå§‹æ•°æ®ï¼Œè¿›è¡Œå·ç§¯æ“ä½œ
* å·ç§¯ç»“æœç§°ä¸º ç‰¹å¾æ˜ å°„

#### æ± åŒ–å±‚
* é€šè¿‡æ± åŒ–è¿›è¡Œä¿¡æ¯å‹ç¼©
* æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼šæœ€å¤§æ± åŒ–ï¼Œé€‰æ‹©åŒºåŸŸä¸­çš„æœ€å¤§å€¼


### æ•°å­¦æ¨¡å‹
#### ç¬¦å·å®šä¹‰
| ç¬¦å· | å«ä¹‰ | 
| -- | -- | 
| $x_{ij}$ | è¾“å…¥å±‚ä¸­ç¥ç»å…ƒçš„è¾“å…¥å€¼ï¼ˆç¬¬iè¡Œï¼Œç¬¬jåˆ—ï¼‰|
| $w_{ij}^{F_k}$ | å»ºç«‹ç¬¬kä¸ªç‰¹å¾æ˜ å°„è¿‡æ»¤å™¨çš„ç¬¬iè¡Œjåˆ—çš„å€¼ |
| $z_{ij}^{F_k}$ | å·ç§¯å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒçš„åŠ æƒè¾“å…¥|
| $b^{F_k}$ | å·ç§¯å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒçš„åç½® |
| $a_{ij}^{F_k}$ | å·ç§¯å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒçš„è¾“å‡º |
| $z_{ij}^{P_k}$| æ± åŒ–å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒçš„è¾“å…¥ |
| $a_{ij}^{P_k}$ | æ± åŒ–å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒçš„è¾“å‡º |
| $w_{k-ij}^{O_n}$| æ± åŒ–å±‚ç¬¬kä¸ªå­å±‚ï¼Œç¬¬iè¡Œjåˆ—ç¥ç»å…ƒæŒ‡å‘è¾“å‡ºå±‚ç¬¬nä¸ªç¥ç»å…ƒçš„æƒé‡|
| $z_n^o$| è¾“å‡ºå±‚ç¬¬nä¸ªç¥ç»å…ƒçš„åŠ æƒè¾“å…¥|
| $b_n^o$| è¾“å‡ºå±‚ç¬¬nä¸ªç¥ç»å…ƒçš„åç½®|
| $a_n^o$| è¾“å‡ºå±‚ç¬¬nä¸ªç¥ç»å…ƒçš„è¾“å‡º|

#### å…³ç³»å›¾
![](https://gitee.com/cc12703/figurebed/raw/master/img/cnn_struct.png)


### å‰å‘ä¼ æ’­ç®—æ³•
#### ä¼ æ’­åˆ°å·ç§¯å±‚
$$
a^l = \sigma(a^{l-1} * W^l + b^l)
$$
è¯´æ˜
* $*$è¡¨ç¤ºå·ç§¯æ“ä½œ
* $\sigma$è¡¨ç¤ºæ¿€æ´»å‡½æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨ReLU

#### ä¼ æ’­åˆ°æ± åŒ–å±‚
$$ a^l = pool(a^{l-1}) $$

### åå‘ä¼ æ’­ç®—æ³•
#### æ± åŒ–å±‚
$$ \delta^{l-1} = upsample(\delta^l) \odot \sigma' z^{l-1} $$

##### upsampleæ“ä½œ
* å¯¹äºæ± åŒ–æ“ä½œmaxï¼Œå°†å€¼æ”¾ç½®åˆ°åŸæ¥çš„ä½ç½®ä¸Š
* å¯¹äºæ± åŒ–æ“ä½œAverageï¼Œå°†å€¼å–å¹³å‡å€¼ï¼Œä¾æ¬¡æ”¾ç½®åœ¨åŸæ¥ä½ç½®ä¸Š

###### upsample-max
$$
\begin{pmatrix}
  2 &8 \\
  4 &6
\end{pmatrix}
=>
\begin{pmatrix}
  2 &0  &0  &0 \\
  0 &0  &0  &8 \\
  0 &4  &0  &0 \\
  0 &0  &6  &0
\end{pmatrix}
$$

###### upsample-average
$$
\begin{pmatrix}
  2 &8 \\
  4 &6
\end{pmatrix}
=>
\begin{pmatrix}
  0.5 &0.5  &2  &2 \\
  0.5 &0.5  &2  &2 \\
  1 &1  &1.5  &1.5 \\
  1 &1  &1.5  &1.5
\end{pmatrix}
$$

#### å·ç§¯å±‚
$$ 
\delta^{l-1} = \delta^l * rot180(W^l) \odot \sigma' z^{l-1}
$$
è¯´æ˜
* $rot180$è¡¨ç¤ºå·ç§¯æ ¸è¢«æ—‹è½¬äº†180åº¦ï¼ˆä¸Šä¸‹ç¿»è½¬ä¸€æ¬¡ï¼Œå·¦å³ç¿»è½¬ä¸€æ¬¡ï¼‰





## å‚è€ƒèµ„æ–™
* https://www.cnblogs.com/pinard/p/6418668.html