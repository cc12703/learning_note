

# 图解密码技术

## 对称密码

### 一次性密码本

#### 算法
* 将明文与一串随机的比特序列进行XOR运算

#### 优点

* 无法被破译：在对其尝试解密过程中，明文的所有的排列组合都会出现，无法判断其中哪一个才是正确的明文

### DES

#### 概述
* 一种对称、分组密码
* 每次只能加密64比特的数据
* 对于长明文需要进行迭代

#### 结构（Feistel网络）
1. 加密的各个步骤称为 **轮**
2. 整个加密过程就是进行若干轮的循环

##### 轮的结构
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116100553.png)

1. 子密钥是指在本轮加密中所使用的密钥
2. 每一轮都需要使用一个不同的子密钥
3. 轮函数：生成用于加密的比特序列，是密码系统的核心

##### 轮的步骤
1. 将输入数据分成左右两部分
2. 将输入右侧直接发送为输出右侧
3. 将输入右侧发送到轮函数
4. 轮函数根据右侧数据和子密钥，生成随机比特序列
5. 将随机序列和左侧数据进行XOR运算，结果作为输出左侧


#### 特性
1. 轮数可以任意增加
2. 使用任何函数作为轮函数都可以正确解密
3. 加密、解密使用完全相同的结构实现


### 三重DES

#### 概述
* 为了增加DES的强度，将DES重复三次所得到的一种密码算法

#### 结构
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116100952.png)

**说明**
* 使用的是 加密 -> 解密  -> 加密过程，为了向下兼容。


### AES

#### 概述
* 由多个轮构成
* 每轮分为四个步骤：SubBytes, ShfitRows, MixColumes, AddRoundKey
* 使用SPN结构



## 分组密码模式
**分组密码是如何进行迭代的**

### ECB模式

#### 概述
* 电子密码本模式
* 将明文分组加密后的结果直接输出为密文分组

#### 结构
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116101252.png)


#### 优点
* 简单
* 快速
* 支持并行加密、解密

#### 缺点
* 明文中的重复排列会出现在密文中
* 通过删除、替换密文分组可以对明文进行操作


### CBC模式

#### 概述
* 密文分组链接模式
* 将明文分组与前一个密文分组进行混合后加密

#### 方法
* 将明文分组与前一个密文分组进行XOR运算，然后再进行加密
* 当加密第一个明文分组时，使用一个初始化向量
* 每次加密时都是随机产生一个不同的比例序列作为初始化向量

#### 结构
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116101432.png)

#### 优点
* 明文中的重复排列不会出现在密文中
* 支持并行解密
* 能够解密任意密文分组


### CTR模式

#### 概述
* 计数器模式
* 通过对逐次累加的计数器进行加密来生成密钥流

#### 方法
* 每次加密时都会生成一个不同的值(nonce)来作为计数器的初始值
* 格式：nonce + 分组序号

#### 结构
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116101536.png)


#### 优点
* 不需要进行填充
* 加密、解密使用相同结构
* 支持并行加密、解密



## 公钥密码

### 密钥配送

#### 难点
* **密钥必要要发送、但又不能发送**

#### 解决方法
1. 通过事先共享密钥
2. 通过密钥分配中心
3. 通过Diffie-Hellman密钥交换
4. 通过公钥密码


### 概述
* 密钥分为：加密密钥、解密密钥
* 发送者使用加密密钥对消息进行加密
* 接收者使用解密密钥对消息进行解密
* 加密密钥是公开的
* 解密密钥由接收者自己保管
* 公钥和私钥是一一对应的


### RSA

#### 公式

##### 加密公式
```math
cryptText = clearText^{E} \quad  mod \quad N 
```

##### 解密公式
```math
clearText = cryptText^{D} \quad mod \quad N
```

**说明**
* 公钥：数E 和 数N
* 私钥：数D 和 数N


#### 生成密钥对

##### 算法
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116101919.png)


##### 求N
1. 准备两个很大的质数(p, q)
2. N = p * q

**通过伪随机数生成器生成一个512比特的数，判断该数是不是质数**

##### 求L
1. L = lcm(p - 1, q = 1)

**lcm表示最小公倍数**

##### 求E
1. 1 <  E < L
2. gcd(E, L) = 1

**gcd表示最大公约数**
**通过伪随机数生成器生成一个数，判断该数是否满足要求**


##### 求D
1. 1 < D < L
2. E x D mod L = 1


## 混合密码系统

### 概述
1. 用对称密码加密消息
2. 通过伪随机数生成器生成会话密钥
3. 用公钥密码加密会话密钥
4. 公钥密码从外部配置

### 要点
* **会话密钥是对称密码的秘钥，同时也是公钥密码的明文**



## 单向散列函数

### 作用
* 用于获取消息的‘指纹’

### 性质
- 根据任意长度的消息计算出固定长度的散列值
- 能够快速计算出散列值
- 消息不同，散列值也不同
- 具备单向性


### 碰撞
* 两个不同的消息生成同一个散列值
* 抗碰撞性：难以发现碰撞的性质
* 弱抗碰撞性：找到和给定消息具有相同散列值的另外一条消息是非常难
* 强抗碰撞性：要找到散列值相同的两条不同的消息是非常困难的


### 实际应用
* 检测软件是否被篡改
* 基于口令的加密
* 消息认证码
* 数字签名
* 伪随机数生成器
* 一次性口令


### 例子
* MD4, MD5
* SHA-1, SHA-2，SHA-3


## 消息认证码

### 概述
* 消息完整性：消息没有被篡改
* 消息认证：消息来自正确的发送者
* 是一种确认完整性并进行认证的技术，简称：MAC值
* 理解成：一种与密钥相关联的单向散列函数
* 问题：如何进行密钥配送

### 元素
* 输入为任意长度的消息
* 一个共享的密钥（发送者和接收者）
* 输出固定长度的数据

### 步骤
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116102600.png)


### 实例
* SWIFT 用于银行之间传递交易消息，共享密钥由人来进行配送
* IPsec 使用消息认证码对通信内容进行认证和完整性校验


### 实现方法

#### 单向散列函数 

**HMAC方法**
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116102659.png)






## 数字签名

### 概述
* 消息认证码的局限：无法防止否认【共享同一个密钥】
* 数字签名使用两个密钥来解决该问题
* 发送者使用’私钥‘来生成签名
* 接收者使用‘另一个密钥’来验证签名

### 要点
* 私钥加密 =》 生成签名
* 公钥解密 =》 验证签名
* 加密后的密文称为‘认证符号’【只有持有该密钥的人才能生成】
* 数字签名实现的并不是防止修改，**识别修改**

### 流程
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116102918.png)


### 方法

#### 对消息的散列值进行签名
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116102946.png)



## 证书

### 含义
* 为公钥加上数字签名

### 公钥证书（PKC）
* 记录了个人信息、此人的公钥
* 由‘认证机构’来施加数字签名

### 标准规范

* **X.509规范使用最广**

#### 要素
* 证书序列号
* 证书颁发者
* 公钥所有者
* 证书ID
* 有效期
* SHA-1指纹
* MD5指纹
* 散列算法
* 密钥类型
* 密钥ID



### 公钥基础设施（PKI）

#### 要素
* 用户 --- 使用PKI
* 认证机构（CA）  --- 颁发证书
* 仓库 --- 保存证书


![](https://gitee.com/cc12703/figurebed/raw/master/img/20201116103154.png)


#### 认证机构的工作
* 生成密钥对
* 注册证书
* 作废证书：使用证书作废清单（CRL）

#### 证书的层级
![图示](https://gitee.com/cc12703/figurebed/raw/master/img/20201116103214.png)





## 密钥

### 密码的本质
* **将较长的秘密（消息）变成较短的秘密（密钥）**


### 什么是密钥
* 密钥就是一个巨大的数字
* 重要的是密钥空间的大小（可能出现的密钥的总数量）
* 密钥空间大小由密钥长度决定

### 分类
* 确保机密性：对称密码、公钥密钥
* 用于认证：消息认证码、数字签名


### 管理

#### 生成密钥
* 随机数生成 （使用针对密码学而设计的伪随机数生成器）
* 口令生成：PBE方法

#### 配送密钥
* 事先共享密钥
* 密钥分配中心
* 公钥密码
* Diffie-Hellman密钥交换

#### Diffie-Hellman密钥交换
TODO