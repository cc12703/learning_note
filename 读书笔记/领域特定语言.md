[TOC]


# 领域特定语言


## 使用DSL

### 定义
* **针对特定领域、具有受限表达性的一种计算机程序设计语言**
* 受限的表达性：DSL只支持特定领域所需要特性的最小集
* 抽象方法：DSL可以看成是程序库的前端，提供了一种不同的操作方式

### 分类
* 外部DSL：采用自定义语法
* 内部DSL：一种通用语言的特定用法
* 语言工作台：专用IDE，用于定义和构建DSL

### 优点
* 提高开发效率：更加清晰地就系统某部分的意图进行沟通
* 改进与领域专家的沟通：领域专家可以读懂，从而理解系统做了什么

### 缺点
* 构建成本：DSL的可维护性

### 实现

* 采用增量方式开发

#### 步骤
1. 测试优先
2. 从一个简单的用例出发，构建出程序库和DSL
3. 逐渐演进程序库和DSL


## 实现DSL

### 总体架构
* DSL是模型上面薄薄的一层结构
* 分离语义模型和DSL
* DSL脚本 --解析-->  语义模型  --生成(可选)-->  目标代码

#### 分离的好处
* 可以更专注于当前领域的语义
* 更方便的对语义进行测试（使用模型）
* 模型和语言可以独立演化

### 测试
* 语义模型的测试：使用命令-查询API来组装语义模型
* 解析器的测试：测试DSL解析是否正确
* 脚本的测试

### 内部DSL

#### 和调用API的核心差别
* 站在语言的角度，思考如何使用组件
* 如何使用子句组装成句子

#### 连贯性API
* 本质：以不同的思路来思考如何使用组件
* 相关点：方法的命名和分解方式
* 规则：方法命名首先要考虑句子，如何构建完整的句子


### 外部DSL

#### 语法指导翻译

##### 词法分析
* 将输入文本转化为一串标记token
* 标记包含：类型和内容

##### 语法分析
* 根据文法规则把标记组织成语法树

#### 文法

##### 正则文法
* 可以用一个有限状态机来处理
* 问题：无法处理嵌套元素

##### 上下文无法文法
* 可以使用下推机（带有栈的有限状态机）来处理
* 问题：变量务必先声明

##### 上下文相关文法