

# GIF格式

## 概述

* 基于调色板
* 最多支持8位色深
* 采用LZW进行压缩


## 组织结构

* 按块进行组织：控制块, 数据块
* 数据块只包含8bit的字符流
* 第一个字节为块大小，该大小不含该字节
* 空数据块也有一个字节的数据，值为0x00

## 文件结构

|  主体结构  |
| :--------: |  
| 文件头 |
|  逻辑屏幕标识符 |
| 全局颜色列表 |
| 图像标识符 |
|  局部颜色列表 |
| 图像数据 | 
| 文件结尾 | 

### 文件头

|  名字  | 大小 | 值 |
| :---: | :---: | :---: |
| GIF文件署名 | 3个字节 | ”GIF“ | 
| 版本号 | 3个字节 | “87a” / "89a" |


### 逻辑屏幕标识符

* 宽度: 2字节，小端
* 高度: 2字节，小端
* 属性: 1字节，格式 m | cr | s | pixel
    * m :  置位(为1)，表示有全局颜色列表
    * s :  置位，表示全局颜色列表要分类排列
    * cr :  颜色深度(cr+1)
    * pixel :  全局颜色列表大小 (pixel+1)
* 背景色，在全局颜色列表中的索引
* 像素宽高比


### 全局颜色列表
* 每个条目由三个字节组成，顺序为 R,G,B                     

### 图像标识符
* 每副图片都有一个，定义图片的性质
* 标识符: 1字节, 值为 0x2c
* x方向偏移量: 2字节，相对于逻辑屏幕
* y方向偏移量: 2字节，相对于逻辑屏幕
* 图像宽度: 2字节
* 图像高度: 2字节
* 属性:  1字节, 格式 m | i | s | r | pixel
    * m  置位，用局部颜色列表, 复位，用全局颜色列表
    * i  置位，使用交织方式排列, 复位，使用顺序方式排列
    * s 分类标志
    * r 保留，值为0
    * pixel 3个bit, 局部颜色列表大小 (pixel+1)


### 局部颜色列表
* 每个条目由三个字节组成，顺序为 R,G,B



### 图像数据
* 基于颜色列表的
* LZW编码长度(1字节)
* 由多个数据块组成的数据
* 块终结器，固定值为 0x00


### 文件结尾
* 1字节，值为0x3

### 其他数据块
* 扩展块，标识为0x21
* 图形控制，标识为0xF9
* 注释，标识为0xFE
* 图形文本，标识为0x01
* 应用程序扩展，标识为0xFF


## 数据存放方式
      
### 交织存放
* 最大以8为周期
* 创建四个通道存放不同行的数据，四个通道依次整个进行放置
* 通道1，从第0行开始没隔8行的数据
* 通道2，从第4行开始每隔8行的数据
* 通道3，从第2行开始每隔4行的数据
* 通道4，从第1行开始每隔2行的数据

### 连续存放
* 按从左到右，从上到下的顺序放置


## LZW算法
* 采用可变长度编码
* 提取原始数据中的不同图案，建立一张编译表
* 用表中的图案索引替换数据中的相应图案
* 编译表是动态生成的