

# OAuth2.0

[TOC]

## 概述

### 是什么
* 是一个授权协议，允许应用代表资源拥有者去访问资源拥有者的资源
* 应用向资源拥有者请求授权，然后获取令牌，最后用它访问资源
* 令牌可以限制应用只能执行资源拥有者授权的操作

### 角色
* 资源拥有者：有权访问资源，并能将资源访问权限委托出去
* 受保护资源：大多数情况下是某种形式的Web API
* 客户端：软件，能代表资源拥有者访问受保护资源

### 目标
* 让客户端为资源拥有者访问受保护资源

## 要点

### 授权访问
* 授权服务器提供了一种机制，来弥补客户端和受保护资源之间的间隙
* 受保护资源依赖于OAuth访问令牌
* 访问令牌是授权服务器向客户端颁发的专用的安全凭据
* 过程：客户端请求令牌，用户对客户端授权，客户端管理令牌，用户管理客户端

#### 图示
![](https://gitee.com/cc12703/figurebed/raw/master/img/20201231183044.png)

### 授权委托
* 委托是OAuth强大功能的根基
* OAuth也是一个委托协议
* 被委托的是用户权限的子集，OAuth本身不承载或者传递权限
* OAuth令牌中的授权信息对系统中大部分组件是不透明的

### 用户主导安全
* 重要的安全决策由最终用户来做
* OAuth遵循TOFU原则（首次使用时信任原则）

#### TOFU原则
* 用户在第一次运行是需要进行安全决策
* 不为安全决策预设任何先决条件
* 系统会记住用户的决策，以便以后使用

##### 优点
* 让用户从功能而不是安全性的角度做成决策


#### 3层名单机制
* 白名单：已知良好和受信任的应用
* 黑名单：已知不良的应用
* 灰名单：使用TOFU原则

### 不能做什么
* 没有定义HTTP协议之外的情形：不应该脱离HTTPS
* 不是身份认证协议：事务本身不透露关于用户的信息
* 没有定义用户对用户的授权机制：假设资源拥有者能够控制客户端
* 没有定义授权处理机制：不定义授权的内容
* 没有定义令牌格式：令牌本身对客户端是不透明的
* 没有定义加密方法：允许借用通用的加密机制
* 不是单体协议：规范被分成了多个定义和流程，每个定义和流程都有各自适用的场景


## 协议概述
### 要点
* 重要步骤：颁发令牌、使用令牌
* 令牌表示授权客户端的访问权

### 事务流程
1. 资源拥有者向客户端表示希望客户端代表它执行的一些任务
1. 客户端在授权服务器上向资源拥有者请求授权
1. 资源拥有者许可客户端的请求
1. 客户端接收到来自授权服务器的令牌
1. 客户端向受保护资源出示令牌

### 授权码许可流程
#### 图示
![](https://gitee.com/cc12703/figurebed/raw/master/img/“3311609687281_.pic_hd”的副本.png)


### 角色
#### 客户端
* 代表资源拥有者访问受保护资源的软件
* 使用OAuth来获取访问权限
* 通常是OAuth系统中最简单的组件

##### 职责
* 从授权服务器获取令牌
* 在受保护资源上使用令牌

#### 受保护资源
* 能够通过HTTP服务器进行访问，访问时需要访问令牌
* 需要验证收到的令牌
* 对是否认可令牌拥有最终决定权

#### 授权服务器
* 一个HTTP服务器，充当中央组件

##### 职责
* 对资源拥有者、客户端进行身份认证
* 让资源拥有者向客户端授权
* 为客户端颁发令牌

#### 资源拥有者
* 是有权将访问权限授权给客户端的主体
* 大多数情况下，资源拥有者是一个人
* 使用客户端访问受他控制的资源

### 组件
#### 访问令牌



