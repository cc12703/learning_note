


# 游戏开发-云风



## 系统整体

### 模块

#### 客户端
* 运行在用户的PC上，使用TCP连接到游戏服务器网关

#### 网关
* 负责汇总所有的客户端
 
#### 客户端代理
* 运行在网关之后
* 逻辑上，每个客户端对应一个agent，用于翻译、转发客户端请求和回应
* 使用 lua state来实现单个agent
                             
#### 数据服务
* 保存玩家数据、场景数据
* 数据库使用Redis

#### 场景管理器
* 用于管理静态场景和动态副本
 
#### 场景服务器
* 用于玩家在里面做漫游

### 设计要点
* 网关之后的服务是相互信任的，组成一个虚拟网络可以相互通讯
* 设计核心是 agent


### agent主体逻辑：
1. 等待用户认证
2. 将信息交给认证服务器认证，失败则返回1
3. 从数据库中获取用户信息，转发给客户端
4. 取到用户所在的场景号，从场景管理器中取到场景服务的位置，并申请加入场景
5. 从场景服务器中同步环境
6. 转发用户在场景中的漫游请求，并同步场景的实时数据
7. 若客户端发生异常或退出，则通知场景服务器离开


### 依赖模块
* 通讯底层使用 ZeroMQ
* 通讯协议使用 google protobuf
* 游戏逻辑使用 lua脚本
