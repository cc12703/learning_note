

# 安全性开发

## 存储用户密码

### 方法

* **使用哈希算法加密用户密码**

### 流程
1. 用户创建账号
2. 密码经过哈希加密后存储在数据库中
3. 用户登录时，将用户输入的密码哈希加密和数据库中的进行对比
4. 若值相同，则用户登录成功。否则，告知用户输入错误

#### 注意点
* 步骤4告知输入错误，必须要显示 ‘无效的用户名或密码’，防止攻击者枚举出有效的用户名
* 只有加密哈希函数才可以用来进行加密密码，比如: SHA256，SHA512

### 破解哈希

#### 字典攻击和暴力攻击
* 属于猜测密码攻击
* 字典攻击使用包含单词、短语、常用密码和其他可能用做密码的字符串的字典文件
* 对文件中的每个词都进行哈希加密，将这些哈希值和要破解的密码哈希值比较
* 暴力攻击是对于给定的密码长度，尝试每一种可能的字符组合

#### 查表法
* **关键点：预先计算**
* 是用于破解相同类型哈希值的一种非常高效的方式
* 想法是预先计算（ pre-compute）出密码字典中的每个密码的哈希值，然后把他们相应的密码存储到一个表里

#### 反向查表法
* **关键点：通常许多用户都会使用相同的密码**
* 攻击者从被黑的用户帐号数据库创建一个用户名和对应的密码哈希表，
* 攻击者猜测一系列哈希值并使用该查询表来查找使用此密码的用户。

#### 彩虹表
* **关键点：彩虹表更小，所以在单位空间可以存储更多的哈希值，从而使攻击更有效**
* 一种以空间换时间的技术。与查表法相似，只是它为了使查询表更小，牺牲了破解速度


### 正确的哈希加密

#### 方法
* **加盐哈希：通过在密码中加入一段随机字符串再进行哈希加密**

#### 流程

##### 存储
1. 使用 CSPRNG 生成足够长的随机盐值
2. 将盐值混入密码，并使用标准的密码哈希函数进行加密
3. 将盐值和对应的哈希值一起存入用户数据库

##### 校验
1. 从数据库检索出用户的盐值和对应的哈希值
2. 将盐值混入用户输入的密码，并且使用通用的哈希函数进行加密
3. 比较是否和数据库存储的哈希值相同


#### 注意点
* 盐值应该使用加密的安全伪随机数生成器( CSPRNG)产生
* 永远在服务端上进行哈希加密
* 使用慢哈希函数  -- 密钥扩展技术 --  采取安全因子或迭代次数作为参数
* 使用固定时间来比较哈希值

