
# 性能优化



## 绘制优化

### 界面卡顿原因

#### 界面绘制 
* 绘制的层级深
* 页面复杂
* 刷新不合理

#### 数据处理 
* 数据处理在UI线程
* 数据处理占用CPU高，导致主线程拿不到时间片
* 内存增加导致GC频繁


### 绘制原理

#### 应用层负责绘制，系统层负责渲染
* 应用程序把经过测量、布局、绘制后的surface缓存数据，通过SurfaceFlinger渲染到显示屏幕上
* 应用层绘制每个view都有三个步骤：measure，layout，draw(软件绘制、硬件加速)

#### 绘制过程
1. 应用层绘制到缓存区
2. SurfaceFlinger把缓存区数据渲染到屏幕
3. android的匿名共享内存保存缓存数据

#### 绘制分工
* CPU负责准备数据：包括 measure、layout、record、execute的数据计算
* GPU负责栅格化、渲染

### 刷新机制
* VSYNC(垂直同步) ：定时中断，CPU接收到后会立刻处理各帧数据
* Triple Buffer ： 三个数据缓存
* Choreographer ：在接收到VSYNC信号后，调用用户设置的回调函数